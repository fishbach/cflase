<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Laser</title>

    <link rel="shortcut icon" type="image/svg+xml" href="/favicon.svg?<!etag!>">
    <script src="http://10.24.75.22:8080/js/laser.js" defer></script>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #ffffff;
        }

        canvas {
            background-color: #a0a0a0;
            width: 95vmin;
            height: 95vmin;
        }
    </style>
</head>

<body>
    <canvas id="screen"></canvas>
    <script>
        const canvas = document.getElementById('screen');
        const ctx    = canvas.getContext('2d');

        function windowResized()
        {
            const size = canvas.clientWidth;
            canvas.width  = size;
            canvas.height = size;

            ctx.strokeStyle = '#0000ff';
            ctx.lineWidth = 1;
            ctx.beginPath();
            const center = size / 2;
            ctx.moveTo(0,    center);
            ctx.lineTo(size, center);
            ctx.moveTo(center, 0);
            ctx.lineTo(center, size);
            ctx.stroke();
        }
        addEventListener('load',   windowResized);
        addEventListener('resize', windowResized);

        canvas.addEventListener('mousemove', (event) => {
            const rect = canvas.getBoundingClientRect();
            const x = -1 + (event.clientX - rect.left) / rect.width  * 2;
            const y =  1 - (event.clientY - rect.top ) / rect.height * 2;

            let points = [];
            points.push(new laser.Point({
                x: -x,
                y: y,
                g: 45
            }));
            laser.show(points, true, Speed);
        });

        let Speed      = null;
        let PointCount = null;

        function initLaser()
        {
            Speed      = laser.MaxSpeed;
            PointCount = laser.OptimalPointCount * 2;

            laser.errorCallback = (error) => {
                console.log('error:', error);
            };
            laser.activeCallback = (active) => {
                console.log('active:', active);
            };
            laser.finishedCallback = () => {
                laser.show(calcNext(), false, Speed);
            };
            let first = calcNext();
            first = first.concat(calcNext());
            // laser.show(first, false, Speed);
            console.log("started ...");
        }

        let shift = 0;
        function calcNext()
        {
            let Pi = Math.PI;
            let pc = PointCount;
            let points = [];
            for (let i = 0 ; i < pc ; ++i) {
                points.push(new laser.Point({
                    x: Math.cos(10 * 2 * Pi * i / pc) / 4,
                    y: Math.sin(10 * 2 * Pi * (i + shift) / pc) / 4,
                    g: 45
                }));
                shift = shift + 0.005;
            }
            return points;
        };

    </script>
</body>
</html>
